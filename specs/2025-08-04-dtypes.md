# Implementing pandas-compatible dtypes

The goal of this project is to implement a `dtypes` property on the `leanframe.core.frame.DataFrame` class and a `dtype` property on the `leanframe.core.series.Series` class. These properties should be compatible with the `pandas` library's `dtypes` and `dtype` properties.

## Background

The `leanframe` library is a lightweight wrapper around `ibis`. The `ibis` library uses its own type system. The `leanframe` `DataFrame` and `Series` objects are backed by `ibis` expressions. The `dtypes` and `dtype` properties should return `pandas` types, specifically `pandas.ArrowDtype` objects that wrap the underlying Arrow types corresponding to the `ibis` types.

## Acceptance Criteria

- A `DataFrame.dtypes` property exists and returns a `pandas.Series` object.
  - The index of the series is the column names of the `DataFrame`.
  - The values of the series are `pandas.ArrowDtype` objects.
- A `Series.dtype` property exists and returns a `pandas.ArrowDtype` object.
- The returned `ArrowDtype` objects correctly represent the underlying `ibis` types.
- The implementation should be covered by unit tests.

## Detailed Steps

### 1. Create a type mapping module

- [x] Create a new module `leanframe/core/dtypes.py` to house the type
      conversion logic.

### 2. Implement the type conversion function

- [x] In `leanframe/core/dtypes.py`, create a function
      `convert_ibis_to_pandas(ibis_type: ibis.expr.datatypes.DataType) ->
      pandas.ArrowDtype`. This function will take an `ibis` type as input and return
      the corresponding `pandas.ArrowDtype`.

### 3. Implement `Series.dtype`

- [x] In `leanframe/core/series.py`, implement the `dtype` property on the
      `Series` class. This property should use the `convert_ibis_to_pandas` function
      to convert the `ibis` type of the series to a `pandas.ArrowDtype`.

### 4. Implement `DataFrame.dtypes`

- [x] In `leanframe/core/frame.py`, implement the `dtypes` property on the
      `DataFrame` class. This property should iterate over the columns of the `ibis`
      table, convert each column's `ibis` type to a `pandas.ArrowDtype` using the
      `convert_ibis_to_pandas` function, and return a `pandas.Series` with the column
      names as the index and the `ArrowDtype` objects as the values.

### 5. Write unit tests

Create unit tests in `tests/unit/test_frame.py` and `tests/unit/test_series.py`
to verify the correctness of the `dtypes` and `dtype` properties.

- [ ] **`test_frame.py`**:
  - [x] Create a test case for `DataFrame.dtypes`.
    Assert that the `dtypes` property returns a `pandas.Series` with the expected `ArrowDtype` objects.
  - [ ] Create a `test_dataframe_dtypes_nested` that includes complex types like `array` and `struct`.
- [ ] **`test_series.py`**:
  - [x] Create parameterized tests for `Series.dtype` that covers some `ibis` types.
        For each `ibis` type, assert that the `dtype` property returns the expected `pandas.ArrowDtype`.
  - [ ] Include complex "nested" types in the parameterized tests.

## Verification

- All new and existing unit tests should pass.
- The `uv run mypy leanframe tests` static type checker should pass.
- The `uv run ruff check` linter should pass.
- Only add git commits. Do not change git history.